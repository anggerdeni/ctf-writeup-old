# deep
## 298 points | 10 solves
### Description
> Because I know, somewhere DeeP down in my heart, I still love you. hwaaaaaaaaaaaaaaaaa  
> author: vidner  

Diberikan file [source.pyc](./challenge/source.pyc), yang merupakan compiled python program. Dapat dengan mudah didecompile dengan `uncompyle6`.
```py
$ uncompyle6 source.pyc
# uncompyle6 version 3.3.5
# Python bytecode 2.7 (62211)
# Decompiled from: Python 2.7.16 (default, Mar 11 2019, 18:59:25)
# [GCC 8.2.1 20181127]
# Embedded file name: source.py
# Compiled at: 2019-07-11 14:01:32
import marshal, zlib, base64
a = 'PCOH2U63N3JUAEB5W2JTRAKCJPUSLFEW4QC6U32AVBC5Z46SQ7SC2ESFN3LKIVU5WSYR2SRBKUSFUIOEIWAIJBFYBDY4JNYAQJ37RGRQGNHEENVI3DPJHGJTWOZTHM4TDL5M6MVNZO2KFXYERI7AHSUEWKQFEUDJVCGDANSUCYVDO4BA2MY2RY2QCNICPICORJNVUHBGIVGYTZYU2QUUCYVGUFHEHTKAZWFDABZVF6MEO7IZKVZD5A2DUBFMCF2EGDQVCDTHOFQKBGSCDXYNF4CSVRPLWPMNNIDB46LELBPTPUP2QIVKLOBIHOZ7B2FT4EAQOJTO3ZJEXKBY46ULVQBGPDN637L5K6C7UNCCOUJ27D5DLZDJAJPKZUUNLNJA4QZY33GZIK7NFSGVETRIOUOSBJZEIPOWG53Q2CD5HBDNXSKRJ52HUVOI445GTFL66V5L2LWXZLLKPOTVKLEJOGWZV737GCCVJA3L7VX4BKE57637VN62CH3CSS7PL6HJS76U4S5A6RJWYFSKL5C6RIXULWCAESR7ISYJGHR4DLVUCAJVSNUF4KK2K54WBLYQOQGJ5RZNCNIZ5ZIOLAHBO6MEFMYVQJZJ36IZTTWTGRUBZ2PTCXD2EMDLH37RK7EDYBQYQGPOHHTEBPBPXDT3BF2AYSKV7CTKUG7RHL6EUICG4Y2DXEVRYLTCS4NG6YONDYSHZHODQFTZTQWFEZTUFYZLCPWWBX3AW3J5OZ5RJ7EVUUUTZGE24W3ILVAGXDWNCXEXDTPBJ3CHEXV3CGT6SN3UTN2U7GHNKCKSKWKWZLWF4HQWWN5UIGLFVPPV2SM7DJFGS332WWW6FXOAVUL53JTSRPFI77FGL66DRPAMONINWDFEWMO3TDDQRJX2LQUXSC2DOWRCVR4NIIRXF3XFDFSJHC73TU4ORMNV5UYNUMC7FOGBA6GZWIZXOA3ZHFCNVWMP7FLBB7FFQ43SYNGRRNRBE7G5VPJDE5EFGHRERWGEHUL4YF3NTVUOHHVOMG63VIOXQKY4HGNCA6DI4TUJ2MGOCP7ACR27QKRA===='
exec marshal.loads(zlib.decompress(base64.b32decode(a)))
# okay decompiling source.pyc
```  
Ternyata program diobfuscate dengan menggunakan marshall. Coba didecompile lagi.  
```py
import marshal, zlib, base64
from uncompyle6.main import decompile
from sys import stdout
a = 'PCOH2U63N3JUAEB5W2JTRAKCJPUSLFEW4QC6U32AVBC5Z46SQ7SC2ESFN3LKIVU5WSYR2SRBKUSFUIOEIWAIJBFYBDY4JNYAQJ37RGRQGNHEENVI3DPJHGJTWOZTHM4TDL5M6MVNZO2KFXYERI7AHSUEWKQFEUDJVCGDANSUCYVDO4BA2MY2RY2QCNICPICORJNVUHBGIVGYTZYU2QUUCYVGUFHEHTKAZWFDABZVF6MEO7IZKVZD5A2DUBFMCF2EGDQVCDTHOFQKBGSCDXYNF4CSVRPLWPMNNIDB46LELBPTPUP2QIVKLOBIHOZ7B2FT4EAQOJTO3ZJEXKBY46ULVQBGPDN637L5K6C7UNCCOUJ27D5DLZDJAJPKZUUNLNJA4QZY33GZIK7NFSGVETRIOUOSBJZEIPOWG53Q2CD5HBDNXSKRJ52HUVOI445GTFL66V5L2LWXZLLKPOTVKLEJOGWZV737GCCVJA3L7VX4BKE57637VN62CH3CSS7PL6HJS76U4S5A6RJWYFSKL5C6RIXULWCAESR7ISYJGHR4DLVUCAJVSNUF4KK2K54WBLYQOQGJ5RZNCNIZ5ZIOLAHBO6MEFMYVQJZJ36IZTTWTGRUBZ2PTCXD2EMDLH37RK7EDYBQYQGPOHHTEBPBPXDT3BF2AYSKV7CTKUG7RHL6EUICG4Y2DXEVRYLTCS4NG6YONDYSHZHODQFTZTQWFEZTUFYZLCPWWBX3AW3J5OZ5RJ7EVUUUTZGE24W3ILVAGXDWNCXEXDTPBJ3CHEXV3CGT6SN3UTN2U7GHNKCKSKWKWZLWF4HQWWN5UIGLFVPPV2SM7DJFGS332WWW6FXOAVUL53JTSRPFI77FGL66DRPAMONINWDFEWMO3TDDQRJX2LQUXSC2DOWRCVR4NIIRXF3XFDFSJHC73TU4ORMNV5UYNUMC7FOGBA6GZWIZXOA3ZHFCNVWMP7FLBB7FFQ43SYNGRRNRBE7G5VPJDE5EFGHRERWGEHUL4YF3NTVUOHHVOMG63VIOXQKY4HGNCA6DI4TUJ2MGOCP7ACR27QKRA===='
marshal_code = marshal.loads(zlib.decompress(base64.b32decode(a)))
decompile(2.7, marshal_code, stdout)
```

```py
# uncompyle6 version 3.3.5
# Python bytecode 2.7
# Decompiled from: Python 2.7.16 (default, Mar 11 2019, 18:59:25)
# [GCC 8.2.1 20181127]
# Embedded file name: <script>
x = [20282409603651670423947251285911L, 158456325028528675187087900574L, 633825300114114700748351602588L, 162259276829213363391578010288020L, 83076749736557242056487941267521419L, 2596148429267413814265248164609936L, 1267650600228229401496703205275L, 158456325028528675187087900574L, 2658455991569831745807614120560689030L, 10633823966279326983230456482242756484L, 664613997892457936451903530140172168L, 20282409603651670423947251285911L, 158456325028528675187087900574L, 83076749736557242056487941267521419L, 41538374868278621028243970633760652L, 549755813848, 166153499473114484112975882535042954L, 5192296858534827628530496329219983L, 39614081257132168796771975072L, 1267650600228229401496703205275L, 2596148429267413814265248164609936L, 664613997892457936451903530140172168L, 1298074214633706907132624082304913L, 39614081257132168796771975072L, 83076749736557242056487941267521419L, 20282409603651670423947251285911L, 2535301200456458802993406410650L, 20769187434139310514121985316880269L, 2535301200456458802993406410650L, 39614081257132168796771975072L, 18014398509481929, 5070602400912917605986812821401L, 1125899906842573, 36028797018963912, 5070602400912917605986812821401L, 9007199254740938, 2251799813685196, 9007199254740938, 42535295865117307932921825928971026306L]
v = --- This code section failed: ---

   3       0  LOAD_FAST             1  'y'          # LOAD_FAST 1 berarti mengambil parameter ke-2 dari fungsi
           3  LOAD_CONST               0
           6  COMPARE_OP            2  ==
           9  POP_JUMP_IF_TRUE     24  'to 24'
          12  LOAD_FAST             1  'y'          # LOAD_FAST 1 berarti mengambil parameter ke-2 dari fungsi
          15  LOAD_FAST             0  'x'          # LOAD_FAST 0 berarti mengambil parameter ke-1 dari fungsi
          18  COMPARE_OP            2  ==
        21_0  COME_FROM             9  '9'
          21  POP_JUMP_IF_FALSE    28  'to 28'
          24  LOAD_CONST               1
          27  RETURN_VALUE_LAMBDA
        28_0  COME_FROM            21  '21'
          28  LOAD_GLOBAL           0  'v'
          31  LOAD_FAST             0  'x'
          34  LOAD_CONST               1
          37  BINARY_SUBTRACT
          38  LOAD_FAST             1  'y'
          41  LOAD_CONST               1
          44  BINARY_SUBTRACT
          45  CALL_FUNCTION_2       2  None
          48  LOAD_GLOBAL           0  'v'
          51  LOAD_FAST             0  'x'
          54  LOAD_CONST               1
          57  BINARY_SUBTRACT
          58  LOAD_FAST             1  'y'
          61  CALL_FUNCTION_2       2  None
          64  BINARY_ADD
          65  RETURN_VALUE_LAMBDA
          -1  LAMBDA_MARKER

Parse error at or near `None` instruction at offset -1
y = lambda x: sum([ v(y, w) for y in range(ord(x)) for w in range(y) ])
z = raw_input('Check flag anda disini :')
u = [ y(i) for i in str(z) ]
w = lambda x, y: 'Selamat yang anda input benar' if x == y else 'Flag yang anda input salah'
print w(u, x)Traceback (most recent call last):
  File "tes.py", line 6, in <module>
    decompile(2.7, marshal_code, stdout)
  File "/usr/lib/python2.7/site-packages/uncompyle6/main.py", line 122, in decompile
    raise pysource.SourceWalkerError(str(e))
uncompyle6.semantics.pysource.SourceWalkerError: Deparsing stopped due to parse error
```

Karena ada beberapa bagian yang gagal didecompile, Kita coba tulis ulang dan decomplie secara manual:  
```py
x = [20282409603651670423947251285911L, 158456325028528675187087900574L, 633825300114114700748351602588L, 162259276829213363391578010288020L, 83076749736557242056487941267521419L, 2596148429267413814265248164609936L, 1267650600228229401496703205275L, 158456325028528675187087900574L, 2658455991569831745807614120560689030L, 10633823966279326983230456482242756484L, 664613997892457936451903530140172168L, 20282409603651670423947251285911L, 158456325028528675187087900574L, 83076749736557242056487941267521419L, 41538374868278621028243970633760652L, 549755813848, 166153499473114484112975882535042954L, 5192296858534827628530496329219983L, 39614081257132168796771975072L, 1267650600228229401496703205275L, 2596148429267413814265248164609936L, 664613997892457936451903530140172168L, 1298074214633706907132624082304913L, 39614081257132168796771975072L, 83076749736557242056487941267521419L, 20282409603651670423947251285911L, 2535301200456458802993406410650L, 20769187434139310514121985316880269L, 2535301200456458802993406410650L, 39614081257132168796771975072L, 18014398509481929, 5070602400912917605986812821401L, 1125899906842573, 36028797018963912, 5070602400912917605986812821401L, 9007199254740938, 2251799813685196, 9007199254740938, 42535295865117307932921825928971026306L]

def v(x,y):
    if (y==0):
        return 1
    if (y==x):
        return 1

    return v(x-1,y-1)+v(x-1,y)

def y(x):
    result = 0
    for y in range(ord(x)):
        for w in range(y):
            result += v(y,w)
    return result

z = raw_input('Check flag anda disini :')
u = [ y(i) for i in str(z) ]
w = lambda x, y: 'Selamat yang anda input benar' if x == y else 'Flag yang anda input salah'
print w(u, x)
```

Hmm intinya input kita setelah masing-masing char nya dimasukkan kedalam fungsi y() harus menghasilkan angka yang sama dengan array x. Langsung saja buat script untuk brute force: 

```py
from string import printable
from sys import stdout
x = [20282409603651670423947251285911L, 158456325028528675187087900574L, 633825300114114700748351602588L, 162259276829213363391578010288020L, 83076749736557242056487941267521419L, 2596148429267413814265248164609936L, 1267650600228229401496703205275L, 158456325028528675187087900574L, 2658455991569831745807614120560689030L, 10633823966279326983230456482242756484L, 664613997892457936451903530140172168L, 20282409603651670423947251285911L, 158456325028528675187087900574L, 83076749736557242056487941267521419L, 41538374868278621028243970633760652L, 549755813848, 166153499473114484112975882535042954L, 5192296858534827628530496329219983L, 39614081257132168796771975072L, 1267650600228229401496703205275L, 2596148429267413814265248164609936L, 664613997892457936451903530140172168L, 1298074214633706907132624082304913L, 39614081257132168796771975072L, 83076749736557242056487941267521419L, 20282409603651670423947251285911L, 2535301200456458802993406410650L, 20769187434139310514121985316880269L, 2535301200456458802993406410650L, 39614081257132168796771975072L, 18014398509481929, 5070602400912917605986812821401L, 1125899906842573, 36028797018963912, 5070602400912917605986812821401L, 9007199254740938, 2251799813685196, 9007199254740938, 42535295865117307932921825928971026306L]
def v(x,y):
    if (y==0):
        return 1
    if (y==x):
        return 1

    return v(x-1,y-1)+v(x-1,y)

def y(x):
    result = 0
    for y in range(ord(x)):
        for w in range(y):
            result += v(y,w)
    return result
    
flag = ''
for i in range(len(x)):
    for j in printable:
        if(y(j) == x[i]):
            flag += j
            stdout.write(j)
            break
 
print ''
print flag

```

Script ini ternyata berjalan sangat lama, maka perlu dilakukan optimasi. Bagian yg paling menghambat jelas merupakan pemanggilan fungsi v secara recursive. Maka kita perlu mengubah implementasi funsgi ini.

Kita coba rubah sedikit implementasi dari fungsi y sehingga sebelum melakukan sum, kita tampilkan semua hasil yg didapatkan.
```py
def v(x,y):
    if (y==0):
        return 1
    if (y==x):
        return 1

    return v(x-1,y-1)+v(x-1,y)

def y(x):
    final_result = 0
    tampung = []
    for y in range(ord(x)):
        tmp_result = 0
        for w in range(y):
            final_result += v(y,w)
            tmp_result += v(y,w)
        print "{} => {}".format(y, tmp_result)
        tampung.append(tmp_result)
    print "sum({}) = {}".format(tampung, final_result)
    return final_result

for i in range(10):
    y(i)
```

Hasilnya: 
```
sum([]) = 0
sum([0]) = 0
sum([0, 1]) = 1
sum([0, 1, 3]) = 4
sum([0, 1, 3, 7]) = 11
sum([0, 1, 3, 7, 15]) = 26
sum([0, 1, 3, 7, 15, 31]) = 57
sum([0, 1, 3, 7, 15, 31, 63]) = 120
sum([0, 1, 3, 7, 15, 31, 63, 127]) = 247
sum([0, 1, 3, 7, 15, 31, 63, 127, 255]) = 502
```

Dengan melihat hasilnya, ternyata pada setiap iterasi y menghasilkan nilai 2**y - 1 lalu semua nilai itu dijumlahkan dan menjadi return value dari fungsi `y`. Langsung bikin solvernya:  
```py
from string import printable
from sys import stdout
x = [20282409603651670423947251285911L, 158456325028528675187087900574L, 633825300114114700748351602588L, 162259276829213363391578010288020L, 83076749736557242056487941267521419L, 2596148429267413814265248164609936L, 1267650600228229401496703205275L, 158456325028528675187087900574L, 2658455991569831745807614120560689030L, 10633823966279326983230456482242756484L, 664613997892457936451903530140172168L, 20282409603651670423947251285911L, 158456325028528675187087900574L, 83076749736557242056487941267521419L, 41538374868278621028243970633760652L, 549755813848, 166153499473114484112975882535042954L, 5192296858534827628530496329219983L, 39614081257132168796771975072L, 1267650600228229401496703205275L, 2596148429267413814265248164609936L, 664613997892457936451903530140172168L, 1298074214633706907132624082304913L, 39614081257132168796771975072L, 83076749736557242056487941267521419L, 20282409603651670423947251285911L, 2535301200456458802993406410650L, 20769187434139310514121985316880269L, 2535301200456458802993406410650L, 39614081257132168796771975072L, 18014398509481929, 5070602400912917605986812821401L, 1125899906842573, 36028797018963912, 5070602400912917605986812821401L, 9007199254740938, 2251799813685196, 9007199254740938, 42535295865117307932921825928971026306L]
flag = ''
store = []
for i in range(0x100):
    store.append(2**i - 1)

for i in range(len(x)):
    for j in printable:
        if(sum(store[:ord(j)]) == x[i]):
            flag += j
            stdout.write(j)
            break
print ''
print 'Flag : {}'.format(flag)
```

### Flag
hacktoday{whats'up_down_there_6f27f535}